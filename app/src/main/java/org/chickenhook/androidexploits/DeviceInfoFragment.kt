package org.chickenhook.androidexploits

import android.os.Bundle
import android.util.Log
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import androidx.fragment.app.Fragment
import androidx.recyclerview.widget.DividerItemDecoration
import androidx.recyclerview.widget.GridLayoutManager
import androidx.recyclerview.widget.LinearLayoutManager
import androidx.recyclerview.widget.RecyclerView

/**
 * A fragment representing a list of Items.
 */
class DeviceInfoFragment : Fragment() {
    val TAG = "DeviceInfoFragment"



    override fun onCreateView(
        inflater: LayoutInflater, container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View? {
        val view = inflater.inflate(R.layout.fragment_device_info_list, container, false)
        activity?.let {
            if( it is MainActivity) {
                it.getConnection{ service ->
                    activity?.runOnUiThread {
                        // Set the adapter
                        if (view is RecyclerView) {
                            with(view) {
                                layoutManager = LinearLayoutManager(context)
                                service?.getDeviceInfo()?.let {
                                    adapter = DeviceInfoAdapter(it.data.toList())
                                }
                                val dividerItemDecoration = DividerItemDecoration(
                                    getContext(),
                                    DividerItemDecoration.VERTICAL
                                )
                                addItemDecoration(dividerItemDecoration)
                            }
                        }

                    }?: kotlin.run {
                        Log.e(TAG, "FirstFragment [-] could not apply ui changes =>fragment is not attached!")
                    }
                }
            } else {
                Log.d(TAG, "didn't text from service... not MainActivity")
            }
        }?: kotlin.run {
            Log.d(TAG, "Fragment is not attached!")
        }

        return view
    }
}
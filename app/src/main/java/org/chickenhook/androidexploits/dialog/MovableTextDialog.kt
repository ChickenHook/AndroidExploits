package org.chickenhook.androidexploits.dialog

import android.content.Context
import android.view.LayoutInflater
import android.view.MotionEvent
import android.view.View
import android.view.ViewGroup
import android.webkit.WebChromeClient
import android.webkit.WebSettings
import android.webkit.WebView
import android.webkit.WebViewClient
import android.widget.ImageButton
import android.widget.TextView
import org.chickenhook.androidexploits.R


class MovableTextDialog(val view: ViewGroup, private val context: Context, private val content: String) {


    fun show() {
        // inflate the layout of the popup window
        // inflate the layout of the popup window
        val inflater = context.getSystemService(Context.LAYOUT_INFLATER_SERVICE) as LayoutInflater
        val popupView: View = inflater.inflate(R.layout.text_dialog, null)
        val textView = popupView.findViewById<TextView>(R.id.text_dialog_textview)
        val close_button = popupView.findViewById<ImageButton>(R.id.text_dialog_close_button)
        val title = popupView.findViewById<TextView>(R.id.webview_dialog_drag)

        close_button?.setOnClickListener {
            view.removeView(popupView)
        }
        //title.setText(url)
        // create the popup window
        textView?.let {
            it.text = content
        }
        view.addView(popupView)
        /*
        MAKE THE DIALOG MOVABLE
         */
        var mDx: Float = 0.0.toFloat();
        var mDy: Float = 0.0.toFloat();
        var mCurrentX = 10
        var mCurrentY = 10
        popupView.x = mCurrentX.toFloat()
        popupView.y = mCurrentY.toFloat()
        val touchListener = View.OnTouchListener { v, event ->
            val action = event.getAction();
            if (action == MotionEvent.ACTION_DOWN) {
                mDx = mCurrentX - event.getRawX();
                mDy = mCurrentY - event.getRawY();
            } else
                if (action == MotionEvent.ACTION_MOVE) {
                    mCurrentX = (event.getRawX() + mDx).toInt();
                    mCurrentY = (event.getRawY() + mDy).toInt();
                    popupView.x = mCurrentX.toFloat()
                    popupView.y = mCurrentY.toFloat()

                }
            true;
        };
        title.setOnTouchListener(touchListener);

        mCurrentX = 20;
        mCurrentY = 50;

    }

}